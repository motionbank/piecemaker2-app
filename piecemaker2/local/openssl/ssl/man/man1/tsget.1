.rn '' }`
''' $RCSfile$$Revision$$Date$
'''
''' $Log$
'''
.de Sh
.br
.if t .Sp
.ne 5
.PP
\fB\\$1\fR
.PP
..
.de Sp
.if t .sp .5v
.if n .sp
..
.de Ip
.br
.ie \\n(.$>=3 .ne \\$3
.el .ne 3
.IP "\\$1" \\$2
..
.de Vb
.ft CW
.nf
.ne \\$1
..
.de Ve
.ft R

.fi
..
'''
'''
'''     Set up \*(-- to give an unbreakable dash;
'''     string Tr holds user defined translation string.
'''     Bell System Logo is used as a dummy character.
'''
.tr \(*W-|\(bv\*(Tr
.ie n \{\
.ds -- \(*W-
.ds PI pi
.if (\n(.H=4u)&(1m=24u) .ds -- \(*W\h'-12u'\(*W\h'-12u'-\" diablo 10 pitch
.if (\n(.H=4u)&(1m=20u) .ds -- \(*W\h'-12u'\(*W\h'-8u'-\" diablo 12 pitch
.ds L" ""
.ds R" ""
'''   \*(M", \*(S", \*(N" and \*(T" are the equivalent of
'''   \*(L" and \*(R", except that they are used on ".xx" lines,
'''   such as .IP and .SH, which do another additional levels of
'''   double-quote interpretation
.ds M" """
.ds S" """
.ds N" """""
.ds T" """""
.ds L' '
.ds R' '
.ds M' '
.ds S' '
.ds N' '
.ds T' '
'br\}
.el\{\
.ds -- \(em\|
.tr \*(Tr
.ds L" ``
.ds R" ''
.ds M" ``
.ds S" ''
.ds N" ``
.ds T" ''
.ds L' `
.ds R' '
.ds M' `
.ds S' '
.ds N' `
.ds T' '
.ds PI \(*p
'br\}
.\"	If the F register is turned on, we'll generate
.\"	index entries out stderr for the following things:
.\"		TH	Title 
.\"		SH	Header
.\"		Sh	Subsection 
.\"		Ip	Item
.\"		X<>	Xref  (embedded
.\"	Of course, you have to process the output yourself
.\"	in some meaninful fashion.
.if \nF \{
.de IX
.tm Index:\\$1\t\\n%\t"\\$2"
..
.nr % 0
.rr F
.\}
.TH TSGET 1 "1.0.1e" "11/Feb/2013" "OpenSSL"
.UC
.if n .hy 0
.if n .na
.ds C+ C\v'-.1v'\h'-1p'\s-2+\h'-1p'+\s0\v'.1v'\h'-1p'
.de CQ          \" put $1 in typewriter font
.ft CW
'if n "\c
'if t \\&\\$1\c
'if n \\&\\$1\c
'if n \&"
\\&\\$2 \\$3 \\$4 \\$5 \\$6 \\$7
'.ft R
..
.\" @(#)ms.acc 1.5 88/02/08 SMI; from UCB 4.2
.	\" AM - accent mark definitions
.bd B 3
.	\" fudge factors for nroff and troff
.if n \{\
.	ds #H 0
.	ds #V .8m
.	ds #F .3m
.	ds #[ \f1
.	ds #] \fP
.\}
.if t \{\
.	ds #H ((1u-(\\\\n(.fu%2u))*.13m)
.	ds #V .6m
.	ds #F 0
.	ds #[ \&
.	ds #] \&
.\}
.	\" simple accents for nroff and troff
.if n \{\
.	ds ' \&
.	ds ` \&
.	ds ^ \&
.	ds , \&
.	ds ~ ~
.	ds ? ?
.	ds ! !
.	ds /
.	ds q
.\}
.if t \{\
.	ds ' \\k:\h'-(\\n(.wu*8/10-\*(#H)'\'\h"|\\n:u"
.	ds ` \\k:\h'-(\\n(.wu*8/10-\*(#H)'\`\h'|\\n:u'
.	ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'^\h'|\\n:u'
.	ds , \\k:\h'-(\\n(.wu*8/10)',\h'|\\n:u'
.	ds ~ \\k:\h'-(\\n(.wu-\*(#H-.1m)'~\h'|\\n:u'
.	ds ? \s-2c\h'-\w'c'u*7/10'\u\h'\*(#H'\zi\d\s+2\h'\w'c'u*8/10'
.	ds ! \s-2\(or\s+2\h'-\w'\(or'u'\v'-.8m'.\v'.8m'
.	ds / \\k:\h'-(\\n(.wu*8/10-\*(#H)'\z\(sl\h'|\\n:u'
.	ds q o\h'-\w'o'u*8/10'\s-4\v'.4m'\z\(*i\v'-.4m'\s+4\h'\w'o'u*8/10'
.\}
.	\" troff and (daisy-wheel) nroff accents
.ds : \\k:\h'-(\\n(.wu*8/10-\*(#H+.1m+\*(#F)'\v'-\*(#V'\z.\h'.2m+\*(#F'.\h'|\\n:u'\v'\*(#V'
.ds 8 \h'\*(#H'\(*b\h'-\*(#H'
.ds v \\k:\h'-(\\n(.wu*9/10-\*(#H)'\v'-\*(#V'\*(#[\s-4v\s0\v'\*(#V'\h'|\\n:u'\*(#]
.ds _ \\k:\h'-(\\n(.wu*9/10-\*(#H+(\*(#F*2/3))'\v'-.4m'\z\(hy\v'.4m'\h'|\\n:u'
.ds . \\k:\h'-(\\n(.wu*8/10)'\v'\*(#V*4/10'\z.\v'-\*(#V*4/10'\h'|\\n:u'
.ds 3 \*(#[\v'.2m'\s-2\&3\s0\v'-.2m'\*(#]
.ds o \\k:\h'-(\\n(.wu+\w'\(de'u-\*(#H)/2u'\v'-.3n'\*(#[\z\(de\v'.3n'\h'|\\n:u'\*(#]
.ds d- \h'\*(#H'\(pd\h'-\w'~'u'\v'-.25m'\f2\(hy\fP\v'.25m'\h'-\*(#H'
.ds D- D\\k:\h'-\w'D'u'\v'-.11m'\z\(hy\v'.11m'\h'|\\n:u'
.ds th \*(#[\v'.3m'\s+1I\s-1\v'-.3m'\h'-(\w'I'u*2/3)'\s-1o\s+1\*(#]
.ds Th \*(#[\s+2I\s-2\h'-\w'I'u*3/5'\v'-.3m'o\v'.3m'\*(#]
.ds ae a\h'-(\w'a'u*4/10)'e
.ds Ae A\h'-(\w'A'u*4/10)'E
.ds oe o\h'-(\w'o'u*4/10)'e
.ds Oe O\h'-(\w'O'u*4/10)'E
.	\" corrections for vroff
.if v .ds ~ \\k:\h'-(\\n(.wu*9/10-\*(#H)'\s-2\u~\d\s+2\h'|\\n:u'
.if v .ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'\v'-.4m'^\v'.4m'\h'|\\n:u'
.	\" for low resolution devices (crt and lpr)
.if \n(.H>23 .if \n(.V>19 \
\{\
.	ds : e
.	ds 8 ss
.	ds v \h'-1'\o'\(aa\(ga'
.	ds _ \h'-1'^
.	ds . \h'-1'.
.	ds 3 3
.	ds o a
.	ds d- d\h'-1'\(ga
.	ds D- D\h'-1'\(hy
.	ds th \o'bp'
.	ds Th \o'LP'
.	ds ae ae
.	ds Ae AE
.	ds oe oe
.	ds Oe OE
.\}
.rm #[ #] #H #V #F C
.SH "NAME"
tsget \- Time Stamping HTTP/HTTPS client
.SH "SYNOPSIS"
\fBtsget\fR
\fB\-h\fR server_url
[\fB\-e\fR extension]
[\fB\-o\fR output]
[\fB\-v\fR]
[\fB\-d\fR]
[\fB\-k\fR private_key.pem]
[\fB\-p\fR key_password]
[\fB\-c\fR client_cert.pem]
[\fB\-C\fR CA_certs.pem]
[\fB\-P\fR CA_path]
[\fB\-r\fR file:file...]
[\fB\-g\fR EGD_socket]
[request]...
.SH "DESCRIPTION"
The \fBtsget\fR command can be used for sending a time stamp request, as
specified in \fBRFC 3161\fR, to a time stamp server over HTTP or HTTPS and storing
the time stamp response in a file. This tool cannot be used for creating the
requests and verifying responses, you can use the OpenSSL \fBts(1)\fR command to
do that. \fBtsget\fR can send several requests to the server without closing
the TCP connection if more than one requests are specified on the command
line.
.PP
The tool sends the following HTTP request for each time stamp request:
.PP
.Vb 7
\&        POST url HTTP/1.1
\&        User-Agent: OpenTSA tsget.pl/<version>
\&        Host: <host>:<port>
\&        Pragma: no-cache
\&        Content-Type: application/timestamp-query
\&        Accept: application/timestamp-reply
\&        Content-Length: length of body
.Ve
.Vb 1
\&        ...binary request specified by the user...
.Ve
\fBtsget\fR expects a response of type application/timestamp-reply, which is
written to a file without any interpretation.
.SH "OPTIONS"
.Ip "\fB\-h\fR server_url" 4
The \s-1URL\s0 of the \s-1HTTP/HTTPS\s0 server listening for time stamp requests.
.Ip "\fB\-e\fR extension" 4
If the \fB\-o\fR option is not given this argument specifies the extension of the
output files. The base name of the output file will be the same as those of
the input files. Default extension is \*(L'.tsr\*(R'. (Optional)
.Ip "\fB\-o\fR output" 4
This option can be specified only when just one request is sent to the
server. The time stamp response will be written to the given output file. \*(L'\-\*(R'
means standard output. In case of multiple time stamp requests or the absence
of this argument the names of the output files will be derived from the names
of the input files and the default or specified extension argument. (Optional)
.Ip "\fB\-v\fR" 4
The name of the currently processed request is printed on standard
error. (Optional)
.Ip "\fB\-d\fR" 4
Switches on verbose mode for the underlying \fBcurl\fR library. You can see
detailed debug messages for the connection. (Optional)
.Ip "\fB\-k\fR private_key.pem" 4
(\s-1HTTPS\s0) In case of certificate-based client authentication over \s-1HTTPS\s0
<private_key.pem> must contain the private key of the user. The private key
file can optionally be protected by a passphrase. The \fB\-c\fR option must also
be specified. (Optional)
.Ip "\fB\-p\fR key_password" 4
(\s-1HTTPS\s0) Specifies the passphrase for the private key specified by the \fB\-k\fR
argument. If this option is omitted and the key is passphrase protected \fBtsget\fR
will ask for it. (Optional)
.Ip "\fB\-c\fR client_cert.pem" 4
(\s-1HTTPS\s0) In case of certificate-based client authentication over \s-1HTTPS\s0
<client_cert.pem> must contain the X.509 certificate of the user.  The \fB\-k\fR
option must also be specified. If this option is not specified no
certificate-based client authentication will take place. (Optional)
.Ip "\fB\-C\fR CA_certs.pem" 4
(\s-1HTTPS\s0) The trusted \s-1CA\s0 certificate store. The certificate chain of the peer's
certificate must include one of the \s-1CA\s0 certificates specified in this file.
Either option \fB\-C\fR or option \fB\-P\fR must be given in case of \s-1HTTPS\s0. (Optional)
.Ip "\fB\-P\fR CA_path" 4
(\s-1HTTPS\s0) The path containing the trusted \s-1CA\s0 certificates to verify the peer's
certificate. The directory must be prepared with the \fBc_rehash\fR
OpenSSL utility. Either option \fB\-C\fR or option \fB\-P\fR must be given in case of
\s-1HTTPS\s0. (Optional)
.Ip "\fB\-rand\fR file:file..." 4
The files containing random data for seeding the random number
generator. Multiple files can be specified, the separator is \fB;\fR for
\s-1MS\s0\-Windows, \fB,\fR for \s-1VMS\s0 and \fB:\fR for all other platforms. (Optional)
.Ip "\fB\-g\fR EGD_socket" 4
The name of an \s-1EGD\s0 socket to get random data from. (Optional)
.Ip "[request]..." 4
List of files containing \fB\s-1RFC\s0 3161\fR \s-1DER\s0\-encoded time stamp requests. If no
requests are specifed only one request will be sent to the server and it will be
read from the standard input. (Optional)
.SH "ENVIRONMENT VARIABLES"
The \fBTSGET\fR environment variable can optionally contain default
arguments. The content of this variable is added to the list of command line
arguments.
.SH "EXAMPLES"
The examples below presume that \fBfile1.tsq\fR and \fBfile2.tsq\fR contain valid
time stamp requests, tsa.opentsa.org listens at port 8080 for HTTP requests
and at port 8443 for HTTPS requests, the TSA service is available at the /tsa
absolute path.
.PP
Get a time stamp response for file1.tsq over HTTP, output is written to 
file1.tsr:
.PP
.Vb 1
\&  tsget -h http://tsa.opentsa.org:8080/tsa file1.tsq
.Ve
Get a time stamp response for file1.tsq and file2.tsq over HTTP showing
progress, output is written to file1.reply and file2.reply respectively:
.PP
.Vb 2
\&  tsget -h http://tsa.opentsa.org:8080/tsa -v -e .reply \e
\&        file1.tsq file2.tsq
.Ve
Create a time stamp request, write it to file3.tsq, send it to the server and
write the response to file3.tsr:
.PP
.Vb 3
\&  openssl ts -query -data file3.txt -cert | tee file3.tsq \e
\&        | tsget -h http://tsa.opentsa.org:8080/tsa \e
\&        -o file3.tsr
.Ve
Get a time stamp response for file1.tsq over HTTPS without client
authentication:
.PP
.Vb 2
\&  tsget -h https://tsa.opentsa.org:8443/tsa \e
\&        -C cacerts.pem file1.tsq
.Ve
Get a time stamp response for file1.tsq over HTTPS with certificate-based
client authentication (it will ask for the passphrase if client_key.pem is
protected):
.PP
.Vb 2
\&  tsget -h https://tsa.opentsa.org:8443/tsa -C cacerts.pem \e
\&        -k client_key.pem -c client_cert.pem file1.tsq
.Ve
You can shorten the previous command line if you make use of the \fBTSGET\fR
environment variable. The following commands do the same as the previous
example:
.PP
.Vb 4
\&  TSGET='-h https://tsa.opentsa.org:8443/tsa -C cacerts.pem \e
\&        -k client_key.pem -c client_cert.pem'
\&  export TSGET
\&  tsget file1.tsq
.Ve
.SH "AUTHOR"
Zoltan Glozik <zglozik@opentsa.org>, OpenTSA project (http://www.opentsa.org)
.SH "SEE ALSO"
openssl(1), ts(1), curl(1), 
\fBRFC 3161\fR

.rn }` ''
.IX Title "TSGET 1"
.IX Name "tsget - Time Stamping HTTP/HTTPS client"

.IX Header "NAME"

.IX Header "SYNOPSIS"

.IX Header "DESCRIPTION"

.IX Header "OPTIONS"

.IX Item "\fB\-h\fR server_url"

.IX Item "\fB\-e\fR extension"

.IX Item "\fB\-o\fR output"

.IX Item "\fB\-v\fR"

.IX Item "\fB\-d\fR"

.IX Item "\fB\-k\fR private_key.pem"

.IX Item "\fB\-p\fR key_password"

.IX Item "\fB\-c\fR client_cert.pem"

.IX Item "\fB\-C\fR CA_certs.pem"

.IX Item "\fB\-P\fR CA_path"

.IX Item "\fB\-rand\fR file:file..."

.IX Item "\fB\-g\fR EGD_socket"

.IX Item "[request]..."

.IX Header "ENVIRONMENT VARIABLES"

.IX Header "EXAMPLES"

.IX Header "AUTHOR"

.IX Header "SEE ALSO"

